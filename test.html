<!DOCTYPE html>
<html lang="en">
<head>
    <title>QBR Dashboard from Subhoo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-sankey/0.12.3/d3-sankey.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/date-fns/2.30.0/date-fns.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://unpkg.com/topojson@3"></script>
    <link rel="stylesheet" href="test_style.css">
</head>
<body>
    <header class="dashboard-header">
        </header>
    <main class="bento-grid">
        <div id="bento-controls" class="bento-box">
            <div class="card-header">
                <div class="card-icon-circle">
                    <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none">
                        <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path>
                    </svg>
                </div>
                <h2>Dashboard Controls</h2>
            </div>
            <div class="card-content">
                <div class="dataset-selector">
                    <label for="dataset-select">Select Dataset:</label>
                    <select id="dataset-select" class="input-select">
                        <option value="">Choose a dataset...</option>
                        </select>
                </div>
                <div class="status-section">
                    <div id="status-banner" class="info">
                        <span id="status-message">Select a dataset to begin</span>
                    </div>
                    <button id="refresh-button" disabled>
                        <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none">
                            <path d="M23 4v6h-6"></path>
                            <path d="M1 20v-6h6"></path>
                            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10"></path>
                            <path d="M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                        </svg>
                        Refresh
                    </button>
                </div>

                <div class="filters-arr-section" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--color-border);">
                     <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 16px;">Filters & ARR Estimator</h3>
                     <div class="arr-filters">
                        <div class="filter-row">
                            <div class="filter-item">
                                <label for="sub-agency-filter">Sub-Agency:</label>
                                <select id="sub-agency-filter" class="input-select">
                                    <option value="">All Sub-Agencies</option>
                                </select>
                            </div>
                            <div class="filter-item">
                                <label for="naics-filter">NAICS Code:</label>
                                <select id="naics-filter" class="input-select">
                                    <option value="">All NAICS</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="arr-result-section">
                        <div class="arr-display">
                            <label>Estimated ARR:</label>
                            <div class="arr-value-display">
                                <div id="arr-loading" style="display: none;">
                                    <div class="spinner"></div>
                                </div>
                                <div id="arr-error" style="display: none;" class="error-message"></div>
                                <div id="arr-no-data" style="display: none;" class="no-data-message"></div>
                                <div id="arr-result" class="value">$0 / year</div>
                            </div>
                        </div>
                        <button id="arr-calculate-button" class="primary-button">
                            Estimate ARR
                        </button>
                        <div style="margin-top: 16px; font-size: 13px; color: var(--color-text-secondary); text-align: left;">
                             <p style="margin-bottom: 10px; text-align: left;"><strong>Estimate ARR for Your Segment</strong></p>
                             <p style="margin-bottom: 10px; text-align: left;">
                                Use the <strong>Search</strong> and <strong>Agency/NAICS filters</strong> to zero in on the part of the market you're focused on. Based on historical contract size and duration, Subhoo gives you a ballpark estimate of potential ARR.
                            </p>
                            <p style="margin-bottom: 10px; text-align: left;">
                                It's not perfect—your actual ARR will depend on pricing, scope, delivery, and margin—but if you're sizing up a new market or pitching internal investment, this gives you a solid starting point.
                            </p>
                        </div>
                    </div>
                </div>
                <div class="dashboard-notes" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--color-border);">
                     <h3 style="font-size: 14px; font-weight: 600; margin-bottom: 8px;">Notes</h3>
                     <p style="font-size: 13px; color: var(--color-text-secondary); margin-bottom: 8px;">
                        This dashboard provides insights into contract data across different agencies. All data is sourced from USAspending.gov.
                    </p>
                    <ul style="font-size: 13px; color: var(--color-text-secondary); margin-left: 16px; margin-bottom: 8px;">
                        <li><strong>TAV</strong> - Total Award Value (Currently Obligated)</li>
                        <li><strong>TCV</strong> - Total Contract Value (Max Potential Value)</li>
                        <li><strong>ARR</strong> - Average Annual Run Rate (Uses Average Annual Contract Value)</li>
                    </ul>
                    <p style="font-size: 13px; color: var(--color-text-secondary);">
                        Use the Search and Agency/NAICS Filters to focus on specific segments.
                    </p>
                </div>
            </div>
        </div>

        <div id="bento-search" class="bento-box">
             </div>

        <div id="bento-tavtcv" class="bento-box">
             </div>

        <div id="bento-leaders" class="bento-box">
             </div>

        <div id="bento-expiring" class="bento-box">
            </div>

        <div id="bento-sankey" class="bento-box">
            </div>

        <div id="bento-map" class="bento-box">
            </div>
    </main>
    <script src="test_script.js" defer></script>
</body>
</html>