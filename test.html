<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales QBR Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/date-fns/2.30.0/date-fns.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <link rel="stylesheet" href="test_style.css">
</head>
<body>
    <header class="dashboard-header">
        <div class="header-content">
            <div class="title-area">
                <h1 id="dashboard-title">Sales QBR Dashboard</h1>
                <p id="dashboard-subtitle">Analyze contract data with precision</p>
            </div>
            <div class="header-controls">
    <div class="date-display">
        <div class="date-number" id="current-date">--</div>
        <div class="date-details" id="date-details">
            <div>--,</div>
            <div>--</div>
        </div>
    </div>
    <div class="date-range">
        <span id="date-range">-- -- - -- --</span>
        <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none"><circle cx="12" cy="12" r="10"></circle><path d="M12 8v8"></path><path d="M8 12h8"></path></svg>
    </div>
</div>
        </div>
    </header>

    <main class="bento-grid">
        <!-- Dataset Selection & Controls Card -->
        <div id="bento-controls" class="bento-box">
            <div class="card-icon">
                <svg viewBox="0 0 24 24" width="20" height="20" stroke="currentColor" stroke-width="2" fill="none"><path d="M4 20h16a2 2 0 0 0 2-2V8.5a2 2 0 0 0-2-2h-7.5"></path><path d="M8 4H4a2 2 0 0 0-2 2v4"></path><path d="M12 14v3"></path><path d="M12 14a2 2 0 0 0 0-4 2 2 0 0 0 0 4z"></path></svg>
            </div>
            <div class="card-content">
                <div class="dataset-selector">
                    <label for="dataset-select">Dataset:</label>
                    <div class="select-wrapper">
                        <select id="dataset-select">
                            <option value="">Select dataset...</option>
                        </select>
                        <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none"><path d="M6 9l6 6 6-6"></path></svg>
                    </div>
                </div>
                <div class="status-section">
                    <div id="status-banner">
                        <p id="status-message">Please select a dataset to begin</p>
                    </div>
                    <button id="refresh-button" class="button" disabled>
                        <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none"><path d="M23 4v6h-6"></path><path d="M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
                        Refresh
                    </button>
                </div>
            </div>
        </div>

        <!-- Monthly Income Card -->
        <div id="bento-income" class="bento-box">
            <div class="card-header">
                <div class="card-icon-circle">
                    <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none"><circle cx="12" cy="12" r="10"></circle><path d="M12 6v12"></path><path d="M8 12h8"></path></svg>
                </div>
                <h2>Monthly Income</h2>
                <div class="metric-badge positive">+8.34%</div>
            </div>
            <div class="income-value">$69,455</div>
            <div id="income-chart-container" class="chart-container">
                <canvas id="incomeChart"></canvas>
            </div>
        </div>

        <!-- TAV vs TCV Chart Card -->
        <div id="bento-tavtcv" class="bento-box">
            <div class="card-header">
                <div class="card-icon-circle">
                    <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none"><path d="M21 6H3"></path><path d="M21 12H3"></path><path d="M21 18H3"></path></svg>
                </div>
                <h2>TAV vs TCV Tracker</h2>
                <div class="chart-control">
                    <span>Top 10 Contracts</span>
                </div>
            </div>
            <div id="tav-tcv-chart-container" class="chart-container">
                <div class="loading-placeholder">
                    <div class="spinner"></div>
                    <span>Loading chart data...</span>
                </div>
                <canvas id="tavTcvChart"></canvas>
            </div>
        </div>

        <!-- Contract Leaders Card -->
        <div id="bento-leaders" class="bento-box">
            <div class="card-header">
                <div class="card-icon-circle">
                    <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                </div>
                <h2>Contract Leaders</h2>
                <div class="chart-control">
                    <span>By Prime Recipient</span>
                </div>
            </div>
            <div id="contract-leaders-table-container" class="table-container">
                <div class="loading-placeholder">
                    <div class="spinner"></div>
                    <span>Loading leaders data...</span>
                </div>
            </div>
        </div>

        <!-- ARR Estimator Card -->
        <div id="bento-arr" class="bento-box">
            <div class="card-header">
                <div class="card-icon-circle">
                    <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none"><path d="M12 1v22"></path><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
                </div>
                <h2>ARR Estimator</h2>
            </div>
            <div class="filter-container">
                <div class="filter-row">
                    <div class="filter-group">
                        <label for="sub-agency-filter">Sub-Agency:</label>
                        <div class="select-wrapper">
                            <select id="sub-agency-filter">
                                <option value="">All Sub-Agencies</option>
                            </select>
                            <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none"><path d="M6 9l6 6 6-6"></path></svg>
                        </div>
                    </div>
                    <div class="filter-group">
                        <label for="naics-filter">NAICS:</label>
                        <div class="select-wrapper">
                            <select id="naics-filter">
                                <option value="">All NAICS</option>
                            </select>
                            <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none"><path d="M6 9l6 6 6-6"></path></svg>
                        </div>
                    </div>
                </div>
                <div class="filter-row">
                    <div class="filter-group">
                        <label for="arr-start-date">Start Date:</label>
                        <div class="date-input-wrapper">
                            <input type="date" id="arr-start-date">
                            <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                        </div>
                    </div>
                    <div class="filter-group">
                        <label for="arr-end-date">End Date:</label>
                        <div class="date-input-wrapper">
                            <input type="date" id="arr-end-date">
                            <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                        </div>
                    </div>
                </div>
                <div class="filter-actions">
                    <button id="arr-calculate-button" class="button primary">
                        <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none"><path d="M5 12h14"></path><path d="M12 5l7 7-7 7"></path></svg>
                        Calculate Avg. ARR
                    </button>
                </div>
            </div>
            <div id="arr-result-container">
                <div class="result-label">Estimated Average Annual Recurring Revenue:</div>
                <div id="arr-result">--</div>
                <div id="arr-loading" class="loading-placeholder" style="display: none;">
                    <div class="spinner"></div>
                    <span>Calculating ARR...</span>
                </div>
                <div id="arr-error" class="error-placeholder" style="display: none;"></div>
                <div id="arr-no-data" class="no-data-placeholder" style="display: none;">No contracts match the selected criteria.</div>
            </div>
        </div>

        <!-- Traffic Status Card -->
        <div id="bento-traffic" class="bento-box">
            <div class="card-header">
                <div class="card-icon-circle">
                    <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none"><circle cx="12" cy="12" r="10"></circle><path d="M16.2 7.8l-2 6.3-6.4 2.1 2-6.3z"></path></svg>
                </div>
                <h2>Traffic Status</h2>
                <div class="metric-badge">78%</div>
            </div>
            <div id="traffic-chart-container" class="chart-container donut-container">
                <canvas id="trafficChart"></canvas>
            </div>
        </div>

        <!-- Notes Card -->
        <div id="bento-notes" class="bento-box">
            <div class="card-header">
                <div class="card-icon-circle">
                    <svg viewBox="0 0 24 24" width="18" height="18" stroke="currentColor" stroke-width="2" fill="none"><path d="M14 3v4a1 1 0 0 0 1 1h4"></path><path d="M17 21H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7l5 5v11a2 2 0 0 1-2 2z"></path><path d="M9 9h1"></path><path d="M9 13h6"></path><path d="M9 17h6"></path></svg>
                </div>
                <h2>Calculation Notes</h2>
            </div>
            <div class="notes-content">
                <p>The TAV vs TCV chart compares the Total Dollars Obligated (TAV) against the Current Total Value of Award (TCV) for the top 10 contracts by TCV, illustrating the funding status or proportion of total value obligated so far.</p>
                <p>The Estimated Average ARR is calculated for filtered contracts by annualizing each contract's Current Total Value over its Period of Performance (Start Date to Current End Date) and then averaging these annualized figures across all valid contracts in the filtered set.</p>
                <p>When a contract's Total Contract Value (TCV) is greater than the Total Amount Obligated (TAV), it means the government hasn't yet funded the contract to its full current value. This gap indicates remaining potential value within the contract's existing structure.</p>
            </div>
        </div>
    </main>
    <script src="test_script.js" defer></script>
</body>
</html>