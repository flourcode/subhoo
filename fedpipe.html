<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Azure ISV Opportunity Interceptor</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f0f2f5;
            color: #333;
            line-height: 1.6;
        }
        
        /* Header */
        .header {
            background: #0078D4;
            color: white;
            padding: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .header-stats {
            display: flex;
            gap: 2rem;
            font-size: 0.9rem;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        /* Main Layout */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem;
        }
        
        /* Filters Bar */
        .filters-bar {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .filters-row {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        .filter-group label {
            display: block;
            font-size: 0.85rem;
            font-weight: 500;
            margin-bottom: 0.25rem;
            color: #666;
        }
        
        .filter-group input,
        .filter-group select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
        }
        
        .filter-group input:focus,
        .filter-group select:focus {
            outline: none;
            border-color: #0078D4;
            box-shadow: 0 0 0 2px rgba(0,120,212,0.2);
        }
        
        .filter-chips {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }
        
        .chip {
            background: #e1e1e1;
            padding: 0.25rem 0.75rem;
            border-radius: 16px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .chip:hover {
            background: #d1d1d1;
        }
        
        .chip.active {
            background: #0078D4;
            color: white;
        }
        
        /* Opportunity Cards */
        .opportunities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .opportunity-card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .opportunity-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .opportunity-score {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: #fff;
            border: 2px solid #0078D4;
            color: #0078D4;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        .opportunity-score.high {
            background: #0078D4;
            color: white;
        }
        
        .opportunity-score.critical {
            background: #D83B01;
            border-color: #D83B01;
            color: white;
        }
        
        .opportunity-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            padding-right: 60px;
        }
        
        .opportunity-agency {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        
        .opportunity-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }
        
        .tag {
            background: #f0f2f5;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .tag.aws {
            background: #FF9900;
            color: white;
        }
        
        .tag.azure {
            background: #0078D4;
            color: white;
        }
        
        .tag.urgent {
            background: #D83B01;
            color: white;
        }
        
        .opportunity-description {
            font-size: 0.9rem;
            color: #555;
            margin-bottom: 1rem;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .opportunity-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: #666;
            padding-top: 1rem;
            border-top: 1px solid #f0f2f5;
        }
        
        .opportunity-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary {
            background: #0078D4;
            color: white;
        }
        
        .btn-primary:hover {
            background: #106EBE;
        }
        
        .btn-secondary {
            background: #f0f2f5;
            color: #333;
        }
        
        .btn-secondary:hover {
            background: #e1e1e1;
        }
        
        /* Loading State */
        .loading {
            text-align: center;
            padding: 3rem;
            color: #666;
        }
        
        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f0f2f5;
            border-top: 4px solid #0078D4;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Stats Dashboard */
        .stats-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .stat-card h3 {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.5rem;
        }
        
        .stat-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: #0078D4;
        }
        
        .stat-card .change {
            font-size: 0.85rem;
            color: #107C10;
            margin-top: 0.25rem;
        }
        
        .stat-card .change.negative {
            color: #D83B01;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 8px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .modal-close {
            font-size: 2rem;
            cursor: pointer;
            color: #666;
            background: none;
            border: none;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .opportunities-grid {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .filter-group {
                min-width: 100%;
            }
        }
        
        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: #107C10;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateX(400px);
            transition: transform 0.3s;
            z-index: 1001;
        }
        
        .toast.show {
            transform: translateX(0);
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div>
                <h1>Azure ISV Opportunity Interceptor</h1>
                <p style="opacity: 0.9; font-size: 0.9rem;">Real-time federal opportunity intelligence</p>
            </div>
            <div class="header-stats">
                <div class="stat-item">
                    <div class="stat-value" id="totalOpps">0</div>
                    <div>Active Opportunities</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="awsAtRisk">0</div>
                    <div>AWS at Risk</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="weeklyGrowth">0%</div>
                    <div>Weekly Growth</div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Quick Stats Dashboard -->
        <div class="stats-dashboard">
            <div class="stat-card">
                <h3>High-Priority Opportunities</h3>
                <div class="value" id="highPriorityCount">0</div>
                <div class="change">↑ 12% from last week</div>
            </div>
            <div class="stat-card">
                <h3>Agencies with Activity</h3>
                <div class="value" id="activeAgencies">0</div>
                <div class="change">New: DoD, VA, DHS</div>
            </div>
            <div class="stat-card">
                <h3>ISV Mentions</h3>
                <div class="value" id="isvMentions">0</div>
                <div class="change">Palantir: 8, C3.ai: 5</div>
            </div>
            <div class="stat-card">
                <h3>Est. Pipeline Value</h3>
                <div class="value" id="pipelineValue">$0M</div>
                <div class="change">↑ $2.5M potential</div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters-bar">
            <div class="filters-row">
                <div class="filter-group">
                    <label>Search Keywords</label>
                    <input type="text" id="searchInput" placeholder="e.g., AI, cloud migration, Palantir">
                </div>
                <div class="filter-group">
                    <label>Agency</label>
                    <select id="agencyFilter">
                        <option value="">All Agencies</option>
                        <option value="dod">Department of Defense</option>
                        <option value="va">Veterans Affairs</option>
                        <option value="dhs">Homeland Security</option>
                        <option value="hhs">Health & Human Services</option>
                        <option value="treasury">Treasury</option>
                        <option value="energy">Energy</option>
                        <option value="justice">Justice</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Opportunity Score</label>
                    <select id="scoreFilter">
                        <option value="">All Scores</option>
                        <option value="90">90+ (Critical)</option>
                        <option value="80">80+ (High)</option>
                        <option value="70">70+ (Medium)</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>ISV Focus</label>
                    <select id="isvFilter">
                        <option value="">All ISVs</option>
                        <option value="palantir">Palantir</option>
                        <option value="c3ai">C3.ai</option>
                        <option value="databricks">Databricks</option>
                        <option value="snowflake">Snowflake</option>
                        <option value="splunk">Splunk</option>
                    </select>
                </div>
                <div class="filter-group" style="display: flex; align-items: flex-end;">
                    <button class="btn btn-primary" onclick="applyFilters()">Apply Filters</button>
                    <button class="btn btn-secondary" onclick="resetFilters()" style="margin-left: 0.5rem;">Reset</button>
                </div>
            </div>
            <div class="filter-chips">
                <span class="chip active" onclick="toggleChip(this, 'aws-risk')">AWS at Risk</span>
                <span class="chip" onclick="toggleChip(this, 'urgent')">Urgent</span>
                <span class="chip" onclick="toggleChip(this, 'ai-ml')">AI/ML</span>
                <span class="chip" onclick="toggleChip(this, 'data-analytics')">Data Analytics</span>
                <span class="chip" onclick="toggleChip(this, 'cloud-migration')">Cloud Migration</span>
                <span class="chip" onclick="toggleChip(this, 'fedramp')">FedRAMP Required</span>
            </div>
        </div>

        <!-- Opportunities Grid -->
        <div id="opportunitiesGrid" class="opportunities-grid">
            <div class="loading">
                <div class="spinner"></div>
                <p>Loading live opportunities...</p>
            </div>
        </div>
    </div>

    <!-- Opportunity Detail Modal -->
    <div id="opportunityModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Opportunity Details</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalBody"></div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script>
        // Configuration
        const CONFIG = {
            refreshInterval: 300000, // 5 minutes
            corsProxies: [
                'https://corsproxy.io/?',
                'https://api.allorigins.win/raw?url=',
                'https://cors.bridged.cc/'
            ],
            feeds: {
                news: [
                    'https://www.fedscoop.com/feed/',
                    'https://www.meritalk.com/feed/',
                    'https://federalnewsnetwork.com/category/technology/feed/',
                    'https://www.fiercegovernment.com/rss/xml'
                ],
                contracts: [
                    'https://sam.gov/api/prod/sgs/v1/search/?size=50&page=0&mode=search&is_active=true&ncode=54',
                    'https://sam.gov/api/prod/sgs/v1/search/?size=50&page=0&mode=search&is_active=true&ncode=70'
                ]
            },
            keywords: {
                critical: ['palantir', 'c3.ai', 'c3 ai', 'aws', 'amazon web services', 'databricks', 'snowflake'],
                high: ['artificial intelligence', 'machine learning', 'ai/ml', 'cloud migration', 'data analytics', 'predictive analytics'],
                azure: ['azure', 'microsoft', 'power platform', 'dynamics', 'teams'],
                urgent: ['urgent', 'immediate', 'expedited', 'pilot', 'proof of concept', 'poc', 'prototype']
            },
            agencies: {
                'dod': ['defense', 'dod', 'pentagon', 'military', 'army', 'navy', 'air force', 'space force'],
                'va': ['veterans', 'va', 'vha', 'vba'],
                'dhs': ['homeland', 'dhs', 'cbp', 'ice', 'uscis', 'tsa', 'fema'],
                'hhs': ['health', 'hhs', 'cdc', 'fda', 'nih', 'cms'],
                'treasury': ['treasury', 'irs', 'financial'],
                'energy': ['energy', 'doe', 'nuclear'],
                'justice': ['justice', 'doj', 'fbi', 'dea', 'atf']
            }
        };

        // Global state
        let opportunities = [];
        let filters = {
            search: '',
            agency: '',
            score: 0,
            isv: '',
            tags: ['aws-risk']
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadOpportunities();
            setInterval(loadOpportunities, CONFIG.refreshInterval);
            
            // Set up event listeners
            document.getElementById('searchInput').addEventListener('keyup', function(e) {
                if (e.key === 'Enter') applyFilters();
            });
        });

        // Data fetching functions
        async function fetchWithCORS(url) {
            for (const proxy of CONFIG.corsProxies) {
                try {
                    const response = await fetch(proxy + encodeURIComponent(url));
                    if (response.ok) return await response.text();
                } catch (error) {
                    console.warn(`Proxy failed: ${proxy}`, error);
                }
            }
            throw new Error('All CORS proxies failed');
        }

        async function loadOpportunities() {
            showToast('Refreshing opportunities...', 2000);
            
            try {
                // Fetch from multiple sources in parallel
                const [newsData, contractData, githubData] = await Promise.all([
                    fetchNewsFeeds(),
                    fetchContractData(),
                    fetchGitHubActivity()
                ]);
                
                // Process and score opportunities
                opportunities = processOpportunities([
                    ...newsData,
                    ...contractData,
                    ...githubData
                ]);
                
                // Update UI
                updateStats();
                renderOpportunities();
                
                showToast(`Loaded ${opportunities.length} opportunities`, 3000);
            } catch (error) {
                console.error('Error loading opportunities:', error);
                showToast('Error loading some data sources', 3000);
            }
        }

        async function fetchNewsFeeds() {
            const items = [];
            
            for (const feedUrl of CONFIG.feeds.news) {
                try {
                    const xmlText = await fetchWithCORS(feedUrl);
                    const parser = new DOMParser();
                    const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
                    const entries = xmlDoc.querySelectorAll('item, entry');
                    
                    entries.forEach((entry, index) => {
                        if (index >= 10) return;
                        
                        const title = entry.querySelector('title')?.textContent || '';
                        const link = entry.querySelector('link')?.textContent || '';
                        const description = entry.querySelector('description, summary')?.textContent || '';
                        const pubDate = entry.querySelector('pubDate, published')?.textContent || '';
                        
                        if (title && (containsKeywords(title + description))) {
                            items.push({
                                id: `news-${Date.now()}-${index}`,
                                title: cleanText(title),
                                link: link,
                                description: cleanText(description),
                                date: new Date(pubDate),
                                source: 'News Feed',
                                type: 'news'
                            });
                        }
                    });
                } catch (error) {
                    console.warn(`Failed to fetch ${feedUrl}:`, error);
                }
            }
            
            return items;
        }

        async function fetchContractData() {
            // For demo purposes, using simulated contract data
            // In production, you'd integrate with SAM.gov API
            const contracts = [
                {
                    id: 'contract-001',
                    title: 'AI/ML Platform Implementation for Predictive Maintenance',
                    description: 'DoD seeks enterprise AI/ML platform for predictive maintenance across military assets. Current solution uses AWS SageMaker.',
                    agency: 'Department of Defense',
                    value: '$45M',
                    date: new Date('2025-05-20'),
                    source: 'SAM.gov',
                    type: 'contract',
                    keywords: ['AI/ML', 'AWS', 'Predictive Analytics']
                },
                {
                    id: 'contract-002',
                    title: 'Veterans Health Data Analytics Modernization',
                    description: 'VA requires modern data analytics platform to replace legacy Palantir Gotham deployment. Seeking cloud-native solution.',
                    agency: 'Veterans Affairs',
                    value: '$75M',
                    date: new Date('2025-05-19'),
                    source: 'SAM.gov',
                    type: 'contract',
                    keywords: ['Palantir', 'Data Analytics', 'Cloud Migration']
                },
                {
                    id: 'contract-003',
                    title: 'DHS Border Analytics Platform - Sources Sought',
                    description: 'DHS exploring alternatives to current C3.ai deployment for border security analytics. FedRAMP High required.',
                    agency: 'Homeland Security',
                    value: '$120M',
                    date: new Date('2025-05-18'),
                    source: 'SAM.gov',
                    type: 'contract',
                    keywords: ['C3.ai', 'Analytics', 'FedRAMP']
                }
            ];
            
            return contracts;
        }

        async function fetchGitHubActivity() {
            try {
                const response = await fetch('https://api.github.com/search/repositories?q=topic:federal-government+language:python+pushed:>2025-01-01&sort=updated&per_page=5');
                const data = await response.json();
                
                return data.items?.map((repo, index) => ({
                    id: `github-${repo.id}`,
                    title: `${repo.full_name} - Federal Open Source Project`,
                    description: repo.description || 'Federal government open source project',
                    date: new Date(repo.updated_at),
                    source: 'GitHub',
                    type: 'github',
                    link: repo.html_url,
                    keywords: ['Open Source', 'Development']
                })) || [];
            } catch (error) {
                console.warn('GitHub API error:', error);
                return [];
            }
        }

        // Processing functions
        function processOpportunities(rawItems) {
            return rawItems
                .map(item => ({
                    ...item,
                    score: calculateOpportunityScore(item),
                    agency: detectAgency(item),
                    tags: extractTags(item),
                    competitors: detectCompetitors(item),
                    azureAdvantage: identifyAzureAdvantage(item)
                }))
                .sort((a, b) => b.score - a.score);
        }

        function calculateOpportunityScore(item) {
            let score = 50; // Base score
            
            const text = `${item.title} ${item.description}`.toLowerCase();
            
            // Critical keywords (competitor mentions)
            CONFIG.keywords.critical.forEach(keyword => {
                if (text.includes(keyword)) score += 15;
            });
            
            // High priority keywords
            CONFIG.keywords.high.forEach(keyword => {
                if (text.includes(keyword)) score += 10;
            });
            
            // Urgent indicators
            CONFIG.keywords.urgent.forEach(keyword => {
                if (text.includes(keyword)) score += 10;
            });
            
            // Azure mentions (negative score - already captured)
            CONFIG.keywords.azure.forEach(keyword => {
                if (text.includes(keyword)) score -= 20;
            });
            
            // Recent opportunities score higher
            const daysSincePost = (new Date() - item.date) / (1000 * 60 * 60 * 24);
            if (daysSincePost < 3) score += 10;
            if (daysSincePost < 7) score += 5;
            
            // Contract opportunities score higher
            if (item.type === 'contract') score += 10;
            
            return Math.min(Math.max(score, 0), 100);
        }

        function detectAgency(item) {
            const text = `${item.title} ${item.description} ${item.agency || ''}`.toLowerCase();
            
            for (const [key, keywords] of Object.entries(CONFIG.agencies)) {
                for (const keyword of keywords) {
                    if (text.includes(keyword)) {
                        return key.toUpperCase();
                    }
                }
            }
            
            return 'Other';
        }

        function extractTags(item) {
            const tags = [];
            const text = `${item.title} ${item.description}`.toLowerCase();
            
            // Check for AWS mentions
            if (CONFIG.keywords.critical.some(k => text.includes(k))) {
                tags.push('aws-risk');
            }
            
            // Check for urgent
            if (CONFIG.keywords.urgent.some(k => text.includes(k))) {
                tags.push('urgent');
            }
            
            // Technology tags
            if (text.includes('ai') || text.includes('artificial intelligence') || text.includes('machine learning')) {
                tags.push('ai-ml');
            }
            
            if (text.includes('data') && (text.includes('analytics') || text.includes('analysis'))) {
                tags.push('data-analytics');
            }
            
            if (text.includes('cloud') && text.includes('migrat')) {
                tags.push('cloud-migration');
            }
            
            if (text.includes('fedramp')) {
                tags.push('fedramp');
            }
            
            return tags;
        }

        function detectCompetitors(item) {
            const competitors = [];
            const text = `${item.title} ${item.description}`.toLowerCase();
            
            if (text.includes('palantir')) competitors.push('Palantir');
            if (text.includes('c3.ai') || text.includes('c3 ai')) competitors.push('C3.ai');
            if (text.includes('aws') || text.includes('amazon web services')) competitors.push('AWS');
            if (text.includes('databricks')) competitors.push('Databricks');
            if (text.includes('snowflake')) competitors.push('Snowflake');
            
            return competitors;
        }

        function identifyAzureAdvantage(item) {
            const advantages = [];
            const text = `${item.title} ${item.description}`.toLowerCase();
            
            if (text.includes('fedramp high')) {
                advantages.push('Azure Government has FedRAMP High authorization');
            }
            
            if (text.includes('il5') || text.includes('secret')) {
                advantages.push('Azure Government Secret regions available');
            }
            
            if (text.includes('teams') || text.includes('collaboration')) {
                advantages.push('Native Teams integration');
            }
            
            if (text.includes('power platform') || text.includes('low-code')) {
                advantages.push('Power Platform for rapid development');
            }
            
            if (text.includes('ai') || text.includes('openai')) {
                advantages.push('Azure OpenAI Service with government compliance');
            }
            
            return advantages;
        }

        // UI Functions
        function renderOpportunities() {
            const grid = document.getElementById('opportunitiesGrid');
            const filtered = filterOpportunities();
            
            if (filtered.length === 0) {
                grid.innerHTML = '<div class="loading"><p>No opportunities match your filters</p></div>';
                return;
            }
            
            grid.innerHTML = filtered.map(opp => `
                <div class="opportunity-card">
                    <div class="opportunity-score ${opp.score >= 90 ? 'critical' : opp.score >= 80 ? 'high' : ''}">${opp.score}</div>
                    <h3 class="opportunity-title">${opp.title}</h3>
                    <div class="opportunity-agency">${opp.agency} • ${formatDate(opp.date)}</div>
                    <div class="opportunity-tags">
                        ${opp.tags.map(tag => `<span class="tag ${tag === 'aws-risk' ? 'aws' : tag === 'urgent' ? 'urgent' : ''}">${formatTag(tag)}</span>`).join('')}
                        ${opp.competitors.map(comp => `<span class="tag aws">${comp}</span>`).join('')}
                    </div>
                    <p class="opportunity-description">${opp.description}</p>
                    <div class="opportunity-meta">
                        <span>${opp.source} ${opp.value ? `• ${opp.value}` : ''}</span>
                        <div class="opportunity-actions">
                            <button class="btn btn-primary" onclick="showOpportunityDetails('${opp.id}')">View Details</button>
                            <button class="btn btn-secondary" onclick="generatePlaybook('${opp.id}')">Generate Playbook</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function filterOpportunities() {
            return opportunities.filter(opp => {
                // Search filter
                if (filters.search) {
                    const searchText = `${opp.title} ${opp.description}`.toLowerCase();
                    if (!searchText.includes(filters.search.toLowerCase())) return false;
                }
                
                // Agency filter
                if (filters.agency && opp.agency !== filters.agency.toUpperCase()) return false;
                
                // Score filter
                if (filters.score && opp.score < filters.score) return false;
                
                // ISV filter
                if (filters.isv) {
                    const hasISV = opp.competitors.some(comp => 
                        comp.toLowerCase().includes(filters.isv.toLowerCase())
                    );
                    if (!hasISV) return false;
                }
                
                // Tag filters
                if (filters.tags.length > 0) {
                    const hasRequiredTags = filters.tags.every(tag => opp.tags.includes(tag));
                    if (!hasRequiredTags) return false;
                }
                
                return true;
            });
        }

        function updateStats() {
            // Update header stats
            document.getElementById('totalOpps').textContent = opportunities.length;
            document.getElementById('awsAtRisk').textContent = opportunities.filter(o => o.tags.includes('aws-risk')).length;
            document.getElementById('weeklyGrowth').textContent = '+15%';
            
            // Update dashboard stats
            document.getElementById('highPriorityCount').textContent = opportunities.filter(o => o.score >= 80).length;
            document.getElementById('activeAgencies').textContent = new Set(opportunities.map(o => o.agency)).size;
            document.getElementById('isvMentions').textContent = opportunities.filter(o => o.competitors.length > 0).length;
            
            // Calculate pipeline value
            const pipelineValue = opportunities.reduce((total, opp) => {
                if (opp.value) {
                    const value = parseFloat(opp.value.replace(/[$M]/g, ''));
                    return total + (value || 0);
                }
                return total;
            }, 0);
            document.getElementById('pipelineValue').textContent = `${Math.round(pipelineValue)}M`;
        }

        // Filter functions
        function applyFilters() {
            filters.search = document.getElementById('searchInput').value;
            filters.agency = document.getElementById('agencyFilter').value;
            filters.score = parseInt(document.getElementById('scoreFilter').value) || 0;
            filters.isv = document.getElementById('isvFilter').value;
            
            renderOpportunities();
            showToast('Filters applied', 2000);
        }

        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('agencyFilter').value = '';
            document.getElementById('scoreFilter').value = '';
            document.getElementById('isvFilter').value = '';
            
            filters = {
                search: '',
                agency: '',
                score: 0,
                isv: '',
                tags: ['aws-risk']
            };
            
            // Reset chips
            document.querySelectorAll('.chip').forEach(chip => {
                chip.classList.toggle('active', chip.textContent.includes('AWS at Risk'));
            });
            
            renderOpportunities();
            showToast('Filters reset', 2000);
        }

        function toggleChip(chip, tag) {
            chip.classList.toggle('active');
            
            if (chip.classList.contains('active')) {
                if (!filters.tags.includes(tag)) {
                    filters.tags.push(tag);
                }
            } else {
                filters.tags = filters.tags.filter(t => t !== tag);
            }
            
            renderOpportunities();
        }

        // Modal functions
        function showOpportunityDetails(oppId) {
            const opp = opportunities.find(o => o.id === oppId);
            if (!opp) return;
            
            const modal = document.getElementById('opportunityModal');
            document.getElementById('modalTitle').textContent = opp.title;
            
            const modalBody = document.getElementById('modalBody');
            modalBody.innerHTML = `
                <div style="display: grid; gap: 1.5rem;">
                    <div>
                        <h3>Overview</h3>
                        <p>${opp.description}</p>
                        <p><strong>Agency:</strong> ${opp.agency}</p>
                        <p><strong>Posted:</strong> ${formatDate(opp.date)}</p>
                        ${opp.value ? `<p><strong>Estimated Value:</strong> ${opp.value}</p>` : ''}
                        <p><strong>Opportunity Score:</strong> ${opp.score}/100</p>
                    </div>
                    
                    ${opp.competitors.length > 0 ? `
                    <div>
                        <h3>Competitor Analysis</h3>
                        <p><strong>Mentioned Competitors:</strong> ${opp.competitors.join(', ')}</p>
                        <p>This opportunity mentions AWS-aligned ISVs, presenting a potential displacement opportunity.</p>
                    </div>
                    ` : ''}
                    
                    ${opp.azureAdvantage.length > 0 ? `
                    <div>
                        <h3>Azure Competitive Advantages</h3>
                        <ul>
                            ${opp.azureAdvantage.map(adv => `<li>${adv}</li>`).join('')}
                        </ul>
                    </div>
                    ` : ''}
                    
                    <div>
                        <h3>Recommended Actions</h3>
                        <ol>
                            <li>Contact the contracting officer for additional details</li>
                            <li>Identify Azure ISV partners with similar capabilities</li>
                            <li>Prepare competitive positioning against ${opp.competitors.join(', ') || 'incumbents'}</li>
                            <li>Schedule technical discovery session with agency stakeholders</li>
                        </ol>
                    </div>
                    
                    <div>
                        <h3>Suggested ISV Partners</h3>
                        <ul>
                            ${suggestISVPartners(opp).map(partner => `<li>${partner}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div style="display: flex; gap: 1rem;">
                        <a href="${opp.link}" target="_blank" class="btn btn-primary">View Original Source</a>
                        <button class="btn btn-secondary" onclick="generatePlaybook('${opp.id}')">Generate Playbook</button>
                        <button class="btn btn-secondary" onclick="exportOpportunity('${opp.id}')">Export to CRM</button>
                    </div>
                </div>
            `;
            
            modal.style.display = 'block';
        }

        function closeModal() {
            document.getElementById('opportunityModal').style.display = 'none';
        }

        // Playbook generation
        function generatePlaybook(oppId) {
            const opp = opportunities.find(o => o.id === oppId);
            if (!opp) return;
            
            const playbook = `
                <h2>Azure ISV Engagement Playbook</h2>
                <h3>${opp.title}</h3>
                
                <h4>Executive Summary</h4>
                <p>${opp.agency} has posted an opportunity that currently favors AWS-aligned ISVs. This presents a displacement opportunity for Azure.</p>
                
                <h4>Competitive Intelligence</h4>
                <ul>
                    <li>Current vendors mentioned: ${opp.competitors.join(', ') || 'None identified'}</li>
                    <li>Opportunity score: ${opp.score}/100</li>
                    <li>Key requirements: ${opp.tags.map(t => formatTag(t)).join(', ')}</li>
                </ul>
                
                <h4>Azure Win Strategy</h4>
                <ol>
                    <li><strong>Compliance Advantage:</strong> Emphasize Azure Government's FedRAMP High and IL5 capabilities</li>
                    <li><strong>Integration Story:</strong> Highlight native integration with M365, Teams, and Power Platform</li>
                    <li><strong>Cost Optimization:</strong> Present Azure Hybrid Benefit and reserved instance savings</li>
                    <li><strong>ISV Ecosystem:</strong> Showcase Azure-native alternatives to incumbent solutions</li>
                </ol>
                
                <h4>Recommended ISV Partners</h4>
                <ul>
                    ${suggestISVPartners(opp).map(partner => `<li>${partner}</li>`).join('')}
                </ul>
                
                <h4>Next Steps</h4>
                <ol>
                    <li>Schedule discovery call with ${opp.agency} technical team</li>
                    <li>Coordinate with suggested ISV partners for joint value prop</li>
                    <li>Prepare technical proof of concept addressing key requirements</li>
                    <li>Draft white paper on Azure advantages for this use case</li>
                </ol>
                
                <h4>Sample Outreach Email</h4>
                <div style="background: #f0f2f5; padding: 1rem; border-radius: 4px; margin-top: 1rem;">
                    <p>Subject: Azure Solutions for ${opp.agency} ${opp.tags.includes('ai-ml') ? 'AI/ML' : 'Technology'} Initiative</p>
                    <p>Dear [Contracting Officer],</p>
                    <p>I noticed your recent posting regarding ${opp.title}. Microsoft Azure Government and our ISV partners have extensive experience delivering similar solutions with enhanced security and compliance features.</p>
                    <p>We'd welcome the opportunity to discuss how Azure's government-specific capabilities could benefit this initiative.</p>
                    <p>Best regards,<br>[Your Name]<br>Azure Federal ISV Team</p>
                </div>
            `;
            
            // Create a new modal for the playbook
            const modal = document.getElementById('opportunityModal');
            document.getElementById('modalTitle').textContent = 'Generated Playbook';
            document.getElementById('modalBody').innerHTML = playbook + `
                <div style="margin-top: 2rem; display: flex; gap: 1rem;">
                    <button class="btn btn-primary" onclick="downloadPlaybook('${oppId}')">Download as PDF</button>
                    <button class="btn btn-secondary" onclick="copyPlaybook()">Copy to Clipboard</button>
                </div>
            `;
            modal.style.display = 'block';
            
            showToast('Playbook generated successfully', 3000);
        }

        function suggestISVPartners(opp) {
            const partners = [];
            const text = `${opp.title} ${opp.description}`.toLowerCase();
            
            if (text.includes('data') || text.includes('analytics')) {
                partners.push('Databricks on Azure', 'Synapse Analytics Partners', 'Informatica');
            }
            
            if (text.includes('ai') || text.includes('machine learning')) {
                partners.push('H2O.ai on Azure', 'DataRobot', 'Dataiku');
            }
            
            if (text.includes('security') || text.includes('cyber')) {
                partners.push('Sentinel Partners', 'CrowdStrike on Azure', 'Palo Alto Prisma');
            }
            
            if (text.includes('database') || text.includes('data warehouse')) {
                partners.push('SingleStore on Azure', 'MongoDB Atlas on Azure', 'Redis Enterprise');
            }
            
            return partners.length > 0 ? partners : ['Generic Azure Marketplace ISVs'];
        }

        // Export functions
        function exportOpportunity(oppId) {
            const opp = opportunities.find(o => o.id === oppId);
            if (!opp) return;
            
            // Create CRM-ready format
            const crmData = {
                name: opp.title,
                agency: opp.agency,
                estimatedValue: opp.value || 'TBD',
                competitors: opp.competitors.join(', '),
                score: opp.score,
                source: opp.source,
                link: opp.link,
                azureAdvantages: opp.azureAdvantage.join('; '),
                suggestedPartners: suggestISVPartners(opp).join(', '),
                tags: opp.tags.join(', '),
                dateFound: new Date().toISOString()
            };
            
            // Copy to clipboard as JSON
            navigator.clipboard.writeText(JSON.stringify(crmData, null, 2));
            showToast('Opportunity data copied to clipboard for CRM import', 3000);
        }

        function downloadPlaybook(oppId) {
            showToast('PDF download would be implemented with a backend service', 3000);
        }

        function copyPlaybook() {
            const playbookContent = document.getElementById('modalBody').innerText;
            navigator.clipboard.writeText(playbookContent);
            showToast('Playbook copied to clipboard', 3000);
        }

        // Utility functions
        function formatDate(date) {
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) return 'Today';
            if (diffDays === 1) return 'Yesterday';
            if (diffDays < 7) return `${diffDays} days ago`;
            
            return date.toLocaleDateString();
        }

        function formatTag(tag) {
            const tagMap = {
                'aws-risk': 'AWS at Risk',
                'urgent': 'Urgent',
                'ai-ml': 'AI/ML',
                'data-analytics': 'Data Analytics',
                'cloud-migration': 'Cloud Migration',
                'fedramp': 'FedRAMP Required'
            };
            
            return tagMap[tag] || tag;
        }

        function containsKeywords(text) {
            const lowerText = text.toLowerCase();
            const allKeywords = [
                ...CONFIG.keywords.critical,
                ...CONFIG.keywords.high,
                ...CONFIG.keywords.azure,
                ...CONFIG.keywords.urgent
            ];
            
            return allKeywords.some(keyword => lowerText.includes(keyword));
        }

        function cleanText(text) {
            const temp = document.createElement('div');
            temp.innerHTML = text;
            return temp.textContent || temp.innerText || '';
        }

        function showToast(message, duration = 3000) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, duration);
        }

        // Handle clicks outside modal
        window.onclick = function(event) {
            const modal = document.getElementById('opportunityModal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>