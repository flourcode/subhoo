/* ========================================= */
/* CSS Variables - Light Mode Muted Purples  */
/* ========================================= */
:root {
    /* Core Color Palette - Muted Purples */
    --light-purple-50: #F4F2F6;  /* Lightest - Background */
    --light-purple-100: #E9E6ED; /* Light - Surface Container */
    --light-purple-200: #D7D4DC; /* Light Mid - Surface Variant */
    --light-purple-300: #B5B0BD; /* Mid - Outline */
    --light-purple-400: #9993A1; /* Mid Dark - Primary */
    --light-purple-500: #797484; /* Dark - Secondary */
    --light-purple-600: #615C66; /* Darkest - Text */

    /* Neutral Colors */
    --white: #FFFFFF;
    --light-text: #36323A;      /* Dark Purple-Gray Text */
    --dark-text: #252327;       /* Darkest Text */

    /* Status Colors */
    --red-500: #ef4444;         /* Error */
    --green-500: #10b981;       /* Success */
    --blue-500: #3e95cd;        /* Info */

    /* Semantic Color Mapping - Light Mode Default */
    --color-background: var(--white);
    --color-surface: var(--light-purple-50);
    --color-surface-container: var(--light-purple-100);
    --color-surface-variant: var(--light-purple-200);

    /* Text Colors */
    --color-text-primary: var(--light-text);
    --color-text-secondary: var(--light-purple-600);
    --color-text-tertiary: var(--light-purple-500);

    /* Action Colors */
    --color-primary: var(--light-purple-400);
    --color-on-primary: var(--white);
    --color-secondary: var(--light-purple-500);
    --color-on-secondary: var(--white);

    /* Border & Outline */
    --color-outline: var(--light-purple-300);
    --color-border: var(--light-purple-200);

    /* Chart Colors */
    --chart-color-primary: var(--light-purple-400);
    --chart-color-secondary: var(--light-purple-500);
    --chart-color-tertiary: var(--light-purple-300);

    /* Status Colors */
    --color-error: var(--red-500);
    --color-success: var(--green-500);
    --color-info: var(--blue-500);

    /* Layout Values */
    --border-radius-sm: 8px;
    --border-radius-md: 12px;
    --border-radius-lg: 16px;
    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
    --shadow-md: 0 2px 4px rgba(0, 0, 0, 0.08);
    --shadow-lg: 0 4px 6px rgba(0, 0, 0, 0.12);
    --transition-standard: all 0.2s ease; /* Standard transition for most elements */
    --bento-gap: 20px;

    /* Added for modern interactive feel */
    --scale-interactive: scale(1.02); /* Subtle scale on hover/focus */
    --color-focus-ring: var(--color-primary); /* Ring color for focus-visible */
}

/* ========================================= */
/* CSS Variables - Dark Mode                 */
/* ========================================= */
[data-theme="dark"] {
    /* Dark Mode - Core Color Palette */
    --color-background: #1E1A22;
    --color-surface: #252229;
    --color-surface-container: #2D2A31;
    --color-surface-variant: #3A373E;

    /* Text Colors */
    --color-text-primary: #F4F2F6;
    --color-text-secondary: #D7D4DC;
    --color-text-tertiary: #B5B0BD;

    /* Action Colors - Brighter for dark mode */
    --color-primary: #A29AAA;
    --color-on-primary: #1E1A22;
    --color-secondary: #8C85A0;
    --color-on-secondary: #1E1A22;

    /* Border & Outline */
    --color-outline: #3A373E; /* Often same as surface-variant in dark */
    --color-border: #3A373E; /* Often same as surface-variant in dark */

    /* Chart Colors - Brighter for dark mode */
    --chart-color-primary: #A29AAA;
    --chart-color-secondary: #8C85A0;
    --chart-color-tertiary: #635C7A;

    /* Shadow adjustments for dark mode (more subtle) */
    --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.2);
    --shadow-md: 0 2px 5px rgba(0, 0, 0, 0.25);
    --shadow-lg: 0 4px 8px rgba(0, 0, 0, 0.3);

    /* Focus ring adjustment for dark mode if needed */
    --color-focus-ring: var(--color-primary);
}

/* ========================================= */
/* Base Styles & Reset                       */
/* ========================================= */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    /* Apply base transition to all elements for smoother theme changes */
    /* transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease; */
    /* Commented out the above broad transition as it can sometimes interfere with more specific ones */
}

html {
    height: 100%;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    scroll-behavior: smooth;
}

body {
    font-family: 'Inter', -apple-system, sans-serif;
    background-color: var(--color-background);
    color: var(--color-text-primary);
    line-height: 1.6; /* Slightly increased line-height for readability */
    font-size: 14px; /* Base size */
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden; /* Keeps scroll managed by layout panes */
    transition: background-color 0.3s ease, color 0.3s ease; /* Smooth theme transition */
}

/* Consistent Heading Styles */
h1, h2, h3, h4, h5, h6 {
    /* Removed font-family here, inherits from body */
    color: var(--color-text-primary);
    font-weight: 700;
    line-height: 1.3;
    margin-bottom: 0.5em; /* Consistent margin */
}

h1 { font-size: 1.75rem; } /* ~28px */
h2 { font-size: 1.125rem; font-weight: 600; } /* ~18px, slightly less bold for card titles */
h3 { font-size: 1rem; } /* ~16px */

/* ========================================= */
/* App Container Styles (Panel Look) - Refined */
/* ========================================= */
/* App container removed as layout is now handled by dashboard-layout */
/* If you need the outer frame back, uncomment the .app-container section */
/*
.app-container {
  background-color: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--border-radius-md);
  box-shadow: var(--shadow-lg);
  margin: 16px;
  height: calc(100vh - 32px);
  max-height: calc(100vh - 32px);
  overflow: hidden;
  display: flex;
  flex-direction: column;
  position: relative;
  transition: var(--transition-standard);
}
@media (max-width: 768px) {
  .app-container { margin: 16px; height: calc(100vh - 32px); max-height: calc(100vh - 32px); }
}
@media (max-width: 480px) {
  .app-container { margin: 0; height: 100vh; max-height: 100vh; border-radius: 0; box-shadow: none; border: none; }
}
*/

/* ========================================= */
/* Base Links & Transitions                  */
/* ========================================= */
a {
    color: var(--color-primary);
    font-weight: 500; /* Standard weight for links */
    text-decoration: none;
    transition: color 0.2s ease;
    border-radius: 2px; /* Added for focus state */
}

a:hover {
    color: var(--color-secondary);
    text-decoration: underline; /* Underline on hover is common */
}

/* Apply theme transitions specifically where needed */
.bento-box, .date-container, .side-panel, button, input, select, label,
.card-icon-circle, #status-banner, .tooltip, .sidebar-info, .sidebar-footer,
.profile-modal, .profile-tab {
    /* Transitioning common properties */
    transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease, opacity 0.2s ease;
}
.bento-box:hover {
    transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease; /* Hover transition */
}

/* ========================================= */
/* Layout Styles                             */
/* ========================================= */
.dashboard-layout {
    display: flex;
    height: 100vh; /* Fill viewport height */
    width: 100vw; /* Fill viewport width */
    overflow: hidden; /* Prevent outer scroll */
    background-color: var(--color-background); /* Ensure layout has BG */
}

.side-panel {
    width: 240px;
    height: 100%;
    background-color: var(--color-surface); /* Use surface color */
    border-right: 1px solid var(--color-border);
    padding: 16px;
    overflow-y: auto;
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    gap: 16px; /* Added gap between direct children */
    scrollbar-width: thin;
    scrollbar-color: var(--color-outline) var(--color-surface-container);
    transition: background-color 0.2s ease, border-color 0.2s ease; /* Theme transitions */
}
.side-panel::-webkit-scrollbar { width: 6px; }
.side-panel::-webkit-scrollbar-track { background: var(--color-surface-container); border-radius: 3px;}
.side-panel::-webkit-scrollbar-thumb { background-color: var(--color-outline); border-radius: 3px; border: 1px solid var(--color-surface-container); }
.side-panel::-webkit-scrollbar-thumb:hover { background-color: var(--color-primary); }

/* Sidebar Info/Footer - Use Classes */
.sidebar-info {
    /* font-family: var(--font-body); */ /* Inherits from body */
    margin-top: 16px; /* Add margin top */
    margin-bottom: 0; /* Reset bottom margin */
    font-size: 12px;
    line-height: 1.5; /* Slightly more spacing */
    color: var(--color-text-secondary);
    background-color: var(--color-surface-container); /* Use container bg */
    padding: 12px;
    border-radius: var(--border-radius-md);
    border: 1px solid var(--color-border);
}
.sidebar-footer {
    /* font-family: var(--font-body); */ /* Inherits */
    margin-top: auto; /* Pushes to bottom */
    padding-top: 12px;
    border-top: 1px solid var(--color-border);
    font-size: 11px;
    color: var(--color-text-tertiary);
    text-align: center;
    flex-shrink: 0; /* Prevent shrinking */
}

/* Main Content Area Scrollbar */
.main-content {
    flex: 1;
    height: 100%;
    overflow-y: auto;
    padding: var(--bento-gap);
    background-color: var(--color-background); /* Main content area background */
    scrollbar-width: auto;
    scrollbar-color: var(--color-outline) transparent;
}
.main-content::-webkit-scrollbar { width: 12px; }
.main-content::-webkit-scrollbar-track { background: transparent; }
.main-content::-webkit-scrollbar-thumb { background-color: var(--color-outline); border-radius: 6px; }
.main-content::-webkit-scrollbar-thumb:hover { background-color: var(--color-primary); }

/* ========================================= */
/* Header Styles                             */
/* ========================================= */
.dashboard-header {
    margin-bottom: var(--bento-gap);
    padding-bottom: var(--bento-gap);
    border-bottom: 1px solid var(--color-border);
}
.header-content { display: flex; justify-content: space-between; align-items: center; gap: 16px; flex-wrap: wrap; } /* Allow wrapping */
.title-area h1 {
    /* font-family: var(--font-heading); */ /* Inherits */
    font-size: 1.5rem; /* ~24px */
    font-weight: 700;
    color: var(--color-text-primary);
    margin: 0;
}
.title-area p {
    /* font-family: var(--font-body); */ /* Inherits */
    font-size: 0.875rem; /* ~14px */
    color: var(--color-text-secondary);
    margin-top: 4px; /* Slightly more space */
    margin-bottom: 0;
}
.header-controls { display: flex; align-items: center; gap: 16px; }
.date-container {
    /* font-family: var(--font-body); */ /* Inherits */
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 12px;
    background-color: var(--color-surface-container);
    border-radius: var(--border-radius-md);
    border: 1px solid var(--color-border);
    font-size: 0.8125rem; /* ~13px */
    color: var(--color-text-secondary);
}
.date-separator { color: var(--color-text-tertiary); opacity: 0.7; }
#date-text, #time-text { font-weight: 500; color: var(--color-text-primary); }

/* ========================================= */
/* Bento Grid Layout                         */
/* ========================================= */
.bento-grid {
    display: grid;
    gap: var(--bento-gap);
    /* Using the 5-column layout from the original CSS */
    grid-template-columns: repeat(5, 1fr);
    grid-template-rows: minmax(250px, auto) minmax(400px, auto) auto auto; /* Adjusted row sizing */
    /* Define grid areas based on original HTML structure intentions */
    grid-template-areas:
    "share-wallet share-wallet tavtcv tavtcv tavtcv"
    "dendrogram dendrogram dendrogram dendrogram dendrogram"
    "sankey sankey sankey leaders leaders"
    "map map naics-donut naics-donut naics-donut"
	"expiring expiring expiring expiring arr" ;	
}

/* Assign grid areas */
#bento-arr { grid-area: arr; }
#bento-naics-distribution { grid-area: naics-donut; }
#bento-sankey { grid-area: sankey; }
#bento-map { grid-area: map; }
#bento-dendrogram { grid-area: dendrogram; min-height: 450px; } /* Ensure enough height */
#bento-tavtcv { grid-area: tavtcv; }
#bento-leaders { grid-area: leaders; }
#bento-expiring { grid-area: expiring; }

/* Ensure Share of Wallet has an area if used */
#bento-share-of-wallet { grid-area: naics-donut; } /* Example: Place it with NAICS or adjust grid */

/* Keep Span Utilities */
.col-span-2 { grid-column: span 2; }
.col-span-3 { grid-column: span 3; } /* Added span 3 */
.col-span-4 { grid-column: span 4; }
.col-span-5 { grid-column: span 5; }

/* ========================================= */
/* Card Styles (`.bento-box`) - Refined      */
/* ========================================= */
.bento-box {
    background-color: var(--color-surface); /* Use surface color */
    border-radius: var(--border-radius-lg); /* Consistent larger radius */
    box-shadow: var(--shadow-sm); /* Softer default shadow */
    padding: 20px; /* Slightly more padding */
    border: 1px solid var(--color-border);
    display: flex;
    flex-direction: column;
    height: 100%; /* Fill grid area */
    position: relative;
    overflow: hidden; /* Clip content */
    transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease; /* Refined transition */
}

.bento-box:hover {
    box-shadow: var(--shadow-md); /* Clearer hover shadow */
    transform: translateY(-2px); /* Slightly more lift */
    border-color: var(--color-outline); /* Use outline color for border emphasis */
}

.card-header {
    display: flex;
    align-items: center;
    gap: 12px; /* Increased gap */
    margin-bottom: 16px; /* Increased margin */
    padding-bottom: 12px; /* Increased padding */
    border-bottom: 1px solid var(--color-border);
    flex-shrink: 0;
}
.card-header h2 {
    /* font-family: var(--font-heading); */ /* Inherits */
    font-size: 1rem; /* ~16px */
    font-weight: 600; /* Slightly less bold */
    color: var(--color-text-primary);
    flex-grow: 1;
    margin: 0;
}
.card-icon-circle {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px; /* Slightly larger */
    height: 32px; /* Slightly larger */
    border-radius: 50%;
    background-color: var(--color-surface-container); /* Changed BG */
    color: var(--color-primary);
    flex-shrink: 0;
    border: 1px solid var(--color-border); /* Added subtle border */
}
.card-icon-circle svg { width: 16px; height: 16px; }
.card-content, .chart-container, .table-container, .arr-display-grid, .notes-content {
    flex-grow: 1; /* Allow content to fill space */
    display: flex;
    flex-direction: column;
    position: relative;
    min-height: 0; /* Prevents flexbox overflow issues */
}

/* ========================================= */
/* Form Element Styles - Refined             */
/* ========================================= */
.input-select, .input-date, input[type="search"], input[type="text"] {
    /* font-family: var(--font-body); */ /* Inherits */
    width: 100%;
    padding: 10px 14px; /* Slightly more padding */
    border: 1px solid var(--color-border);
    border-radius: var(--border-radius-md); /* Consistent radius */
    font-size: 0.875rem; /* ~14px */
    color: var(--color-text-primary);
    background-color: var(--color-background); /* Use main background for inputs */
    transition: var(--transition-standard);
    line-height: 1.5; /* Ensure text fits */
}
.input-select:focus, .input-date:focus, input[type="search"]:focus, input[type="text"]:focus {
    outline: 2px solid transparent;
    outline-offset: 2px;
    border-color: var(--color-primary);
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--color-primary) 25%, transparent); /* Softer focus ring */
    background-color: var(--color-background);
}
.input-select option {
    background-color: var(--color-background); /* Ensure dropdown options match theme */
    color: var(--color-text-primary);
}
::placeholder {
    color: var(--color-text-tertiary);
    opacity: 0.9; /* Slightly less faint */
    /* font-family: var(--font-body); */ /* Inherits */
}

/* Specific adjustments for search input */
input[type="search"] {
    /* Add specific styles if needed, e.g., for clear button */
}

/* ========================================= */
/* Button Styles - Refined                   */
/* ========================================= */
button, .button, .primary-button {
    /* font-family: var(--font-body); */ /* Inherits */
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px; /* Slightly more gap */
    padding: 10px 16px; /* Slightly more padding */
    border-radius: var(--border-radius-md); /* Consistent radius */
    font-size: 0.875rem; /* ~14px */
    font-weight: 600;
    cursor: pointer;
    border: 1px solid var(--color-border);
    text-align: center;
    vertical-align: middle;
    white-space: nowrap;
    transition: background-color 0.15s ease, border-color 0.15s ease, color 0.15s ease, transform 0.15s ease, box-shadow 0.15s ease; /* Slightly faster transitions */
    user-select: none; /* Prevent text selection */
}
button svg, .button svg, .primary-button svg { width: 16px; height: 16px; }

/* Standard Button */
button, .button {
    background-color: var(--color-surface-container); /* Use container bg */
    color: var(--color-text-primary); /* Use primary text color */
    border-color: var(--color-border); /* Use standard border */
}
button:hover:not(:disabled), .button:hover:not(:disabled) {
    background-color: var(--color-surface-variant); /* Darken slightly on hover */
    border-color: var(--color-outline); /* Use outline color */
    transform: translateY(-1px); /* Subtle lift */
    color: var(--color-text-primary);
}
button:active:not(:disabled), .button:active:not(:disabled) {
    transform: translateY(0px); /* Press down effect */
    background-color: var(--color-surface-variant);
}

/* Primary Button */
.primary-button {
    background-color: var(--color-primary);
    color: var(--color-on-primary);
    border-color: var(--color-primary);
    box-shadow: var(--shadow-sm); /* Add subtle shadow */
}
.primary-button:hover:not(:disabled) {
    background-color: color-mix(in srgb, var(--color-primary) 85%, var(--color-background));
    border-color: color-mix(in srgb, var(--color-primary) 85%, var(--color-background));
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
}
.primary-button:active:not(:disabled) {
    transform: translateY(0px);
    box-shadow: none;
}

/* Disabled State */
button:disabled, .button:disabled, .primary-button:disabled {
    opacity: 0.6; /* Slightly more visible */
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

/* Theme Toggle Button */
#theme-toggle-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 6px; /* Slightly more padding */
    margin-left: auto; /* Keep it pushed right */
    border-radius: 50%; /* Make it round */
    display: flex; /* Ensure icon centers */
    align-items: center;
    justify-content: center;
    color: var(--color-text-secondary); /* Use secondary text color */
}
#theme-toggle-btn:hover {
    background-color: var(--color-surface-variant); /* Add hover background */
    color: var(--color-primary);
}
.theme-icon {
    width: 18px;
    height: 18px;
}

/* ========================================= */
/* Sidebar Specific Controls                 */
/* ========================================= */
.side-panel > div:first-of-type { /* Target the header div */
    padding-bottom: 16px; /* Add padding below header */
    border-bottom: 1px solid var(--color-border); /* Add separator line */
    margin-bottom: 16px; /* Add margin below header block */
}

.side-panel > div:has(#dataset-select) { /* Target the main controls div */
    display: flex;
    flex-direction: column;
    gap: 12px; /* Adjust gap */
}
.side-panel h2 {
    /* font-family: var(--font-heading); */ /* Inherits */
    font-size: 0.75rem; /* ~12px */
    font-weight: 600; /* Less bold */
    color: var(--color-text-secondary);
    margin: 8px 0 4px 0; /* Adjust margin */
    text-transform: uppercase;
    letter-spacing: 0.07em;
}
#status-banner {
    /* font-family: var(--font-body); */ /* Inherits */
    padding: 10px 12px; /* Increased padding */
    border-radius: var(--border-radius-md); /* Consistent radius */
    font-size: 0.8125rem; /* ~13px */
    color: var(--color-text-secondary);
    background-color: var(--color-surface-container); /* Use container bg */
    border: 1px solid var(--color-border); /* Standard border */
    text-align: center;
    margin-top: 8px;
    line-height: 1.4; /* Improve readability */
    transition: var(--transition-standard); /* Smooth changes */
}
/* Status colors using oklch are good */
#status-banner.error { background-color: oklch(from var(--color-error) l c h / 10%); color: var(--color-error); border-color: oklch(from var(--color-error) l c h / 30%); }
#status-banner.success { background-color: oklch(from var(--color-success) l c h / 10%); color: var(--color-success); border-color: oklch(from var(--color-success) l c h / 30%); }
#status-banner.info { background-color: oklch(from var(--color-info) l c h / 15%); color: var(--color-info); border-color: oklch(from var(--color-info) l c h / 30%); }

/* Filter container styling if needed */
.filter-container, .filter-row, .filter-item { /* Keep structure */ }
.filter-item label {
    /* font-family: var(--font-body); */ /* Inherits */
    font-size: 0.8125rem; /* ~13px */
    font-weight: 500; /* Standard weight */
    color: var(--color-text-secondary);
    margin-bottom: 4px; /* Add space below label */
    display: block; /* Ensure label is above input */
}

/* ========================================= */
/* Table Styles - Refined                    */
/* ========================================= */
.table-container {
    overflow: hidden;
    margin-top: 16px; /* Increased spacing */
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    border: 1px solid var(--color-border); /* Add border around container */
    border-radius: var(--border-radius-md); /* Rounded corners */
}
.table-wrapper {
    overflow: auto; /* Handles scrolling */
    flex-grow: 1;
    border-radius: inherit; /* Inherit border-radius */
    /* Improved scrollbar styling for table wrapper */
    scrollbar-width: thin;
    scrollbar-color: var(--color-outline) transparent;
}
.table-wrapper::-webkit-scrollbar { height: 8px; width: 8px; } /* Horizontal and vertical */
.table-wrapper::-webkit-scrollbar-track { background: transparent; }
.table-wrapper::-webkit-scrollbar-thumb { background-color: var(--color-outline); border-radius: 4px; border: 2px solid var(--color-surface); } /* Add border to thumb */
.table-wrapper::-webkit-scrollbar-thumb:hover { background-color: var(--color-primary); }

table {
    width: 100%;
    border-collapse: collapse; /* Use collapse for cleaner lines */
    /* font-family: var(--font-body); */ /* Inherits */
    font-size: 0.8125rem; /* ~13px */
}
th, td {
    padding: 10px 14px; /* Increased padding */
    text-align: left;
    border-bottom: 1px solid var(--color-border);
    white-space: nowrap;
    vertical-align: middle; /* Align text vertically */
}
th {
    /* font-family: var(--font-heading); */ /* Use body font for consistency */
    font-weight: 600; /* Slightly less bold */
    color: var(--color-text-secondary);
    text-transform: none; /* Removed uppercase */
    letter-spacing: normal; /* Removed letter spacing */
    background-color: var(--color-surface-container); /* Header background */
    position: sticky;
    top: 0;
    z-index: 1;
    transition: background-color 0.2s ease; /* Smooth hover */
}
th:first-child { border-top-left-radius: var(--border-radius-md); } /* Round top corners */
th:last-child { border-top-right-radius: var(--border-radius-md); }

td { color: var(--color-text-primary); }
td.number, th.number { text-align: right; font-variant-numeric: tabular-nums; } /* Combined number alignment */
td.font-medium { font-weight: 500; }
td.font-bold { font-weight: 700; }
td.text-center { text-align: center; }
td.text-red-600 { color: var(--color-error); }

tr:hover td { background-color: var(--color-surface-variant); }
tr:last-child td { border-bottom: none; } /* Remove border on last row */
tr:last-child td:first-child { border-bottom-left-radius: var(--border-radius-md); } /* Round bottom corners */
tr:last-child td:last-child { border-bottom-right-radius: var(--border-radius-md); }

.summary-text {
    /* font-family: var(--font-body); */ /* Inherits */
    font-size: 0.75rem; /* ~12px */
    color: var(--color-text-tertiary);
    margin-top: 12px; /* Increased spacing */
    padding: 10px 14px; /* Consistent padding */
    border-top: 1px solid var(--color-border);
    flex-shrink: 0;
    background-color: var(--color-surface-container); /* Footer background */
    border-bottom-left-radius: var(--border-radius-md); /* Round corners */
    border-bottom-right-radius: var(--border-radius-md);
}
/* Allow wrapping for specific columns */
#expiring-contracts-table-container td:nth-child(3),
#contract-leaders-table-container td:nth-child(5) { /* Adjusted index for leaders majority work */
    white-space: normal;
    word-wrap: break-word;
    max-width: 250px; /* Increased max-width */
    min-width: 150px; /* Ensure minimum width */
}
#contract-leaders-table-container td:nth-child(1) { /* Leader name */
    white-space: normal;
    word-wrap: break-word;
    max-width: 200px;
    min-width: 120px;
}


/* ========================================= */
/* Chart & Visualization Containers          */
/* ========================================= */
.chart-container {
    min-height: 220px; /* Minimum height */
    flex-grow: 1;
    position: relative;
    width: 100%;
    display: flex; /* Use flex for centering placeholders */
    align-items: center;
    justify-content: center;
}
/* Ensure SVG/Canvas fill the container */
.chart-container > svg,
.chart-container > canvas {
    display: block;
    width: 100%;
    height: 100%;
    max-height: 100%; /* Ensure it doesn't overflow */
}

/* ========================================= */
/* Specific Component Styles                 */
/* ========================================= */
/* ARR Display - Refined */
.arr-display-grid {
    justify-content: center;
    align-items: center;
    text-align: center;
    flex-grow: 1; /* Allow grid to fill space */
    padding: 20px 0; /* Add padding */
    display: flex; /* Use flex for better centering */
    flex-direction: column;
}
.arr-grid-value {
    /* font-family: var(--font-heading); */ /* Use body font */
    font-size: 2.5rem; /* Larger font size */
    color: var(--color-primary);
    margin-bottom: 12px; /* More space */
    font-weight: 700;
    line-height: 1.1; /* Tighten line height */
}
.arr-description {
    /* font-family: var(--font-body); */ /* Inherits */
    font-size: 0.8125rem; /* ~13px */
    color: var(--color-text-secondary);
    max-width: 85%; /* Slightly wider */
    margin: 0 auto;
    line-height: 1.5; /* Better readability */
}

/* Notes - Refined */
.notes-content {
    /* font-family: var(--font-body); */ /* Inherits */
    color: var(--color-text-secondary);
    font-size: 0.8125rem; /* ~13px */
    overflow-y: auto; /* Allow scrolling if needed */
    padding: 4px; /* Add slight padding */
    line-height: 1.6; /* Improve readability */
}
.notes-content p { margin-bottom: 1em; } /* Use em for spacing */
.notes-content p:last-child { margin-bottom: 0; }
.notes-content ul { margin-left: 20px; margin-bottom: 1em; }
.notes-content ul li { margin-bottom: 0.5em; }
.notes-content strong { color: var(--color-text-primary); font-weight: 600; }

/* ========================================= */
/* Loading, Error, No Data States - Centered */
/* ========================================= */
.loading-placeholder, .error-placeholder, .no-data-placeholder {
    /* font-family: var(--font-body); */ /* Inherits */
    display: flex;
    flex-direction: column; /* Stack icon and text */
    align-items: center;
    justify-content: center;
    position: absolute; /* Position over content */
    top: 0; left: 0; right: 0; bottom: 0;
    padding: 20px;
    text-align: center;
    color: var(--color-text-tertiary);
    font-size: 0.875rem; /* ~14px */
    background-color: color-mix(in srgb, var(--color-surface) 90%, transparent); /* Semi-transparent BG */
    z-index: 5; /* Ensure it's above chart/table content */
    border-radius: inherit; /* Match parent radius */
    opacity: 1;
    transition: opacity 0.2s ease;
}
.loading-placeholder span, .error-placeholder, .no-data-placeholder {
    margin-top: 12px; /* Space between spinner and text */
}
.error-placeholder { color: var(--color-error); }
.no-data-placeholder { /* Uses default tertiary color */ }

/* Hide placeholders when not active */
.loading-placeholder:not([style*="display: flex"]),
.error-placeholder:not([style*="display: flex"]),
.no-data-placeholder:not([style*="display: flex"]) {
    display: none !important; /* Override inline style if needed */
    opacity: 0;
    pointer-events: none;
}

/* Spinner */
.spinner {
    width: 32px; height: 32px;
    border: 3px solid var(--color-surface-variant);
    border-top-color: var(--color-primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

/* Pulse animation could be used for placeholders */
/* @keyframes pulse { 0%, 100% { opacity: 0.7; } 50% { opacity: 1; } } */
/* .loading-placeholder, .error-placeholder, .no-data-placeholder { animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite; } */


/* ========================================= */
/* Utility Classes                           */
/* ========================================= */
.detail-link {
    /* font-family: var(--font-body); */ /* Inherits */
    color: var(--color-primary);
    text-decoration: none;
    font-weight: 500; /* Standard weight */
    border-radius: 2px; /* Add radius for focus */
}
.detail-link:hover {
    color: var(--color-secondary);
    text-decoration: underline;
}

/* ========================================= */
/* Responsive Adjustments - Refined Grid     */
/* ========================================= */
@media (max-width: 1200px) {
    /* Adjust grid for slightly smaller screens if needed */
    .bento-grid {
        /* Example: Change TAV/TCV span */
        /* grid-template-areas:
           "arr arr naics-donut naics-donut"
           "sankey sankey map map"
           "dendrogram dendrogram tavtcv tavtcv"
           "leaders leaders leaders leaders"
           "expiring expiring expiring expiring"; */
    }
     body { font-size: 13.5px; }
}

@media (max-width: 992px) { /* Tablet */
    .side-panel { width: 220px; } /* Slightly wider */
    .bento-grid {
        grid-template-columns: repeat(2, 1fr); /* 2 Columns */
        grid-template-rows: auto; /* Let content define height */
        /* Define areas for 2-column layout */
        grid-template-areas:
            "arr naics-donut" /* Row 1 */
            "sankey map"      /* Row 2 */
            "dendrogram tavtcv" /* Row 3 */
            "leaders leaders" /* Row 4 */
            "expiring expiring";/* Row 5 */
        gap: 16px; /* Reduce gap */
    }
    .bento-box { grid-column: auto !important; grid-area: auto !important; } /* Reset spans first */
    /* Assign areas */
    #bento-arr { grid-area: arr; }
    #bento-naics-distribution { grid-area: naics-donut; }
    #bento-sankey { grid-area: sankey; }
    #bento-map { grid-area: map; }
    #bento-dendrogram { grid-area: dendrogram; min-height: 350px; }
    #bento-tavtcv { grid-area: tavtcv; }
    #bento-leaders { grid-area: leaders; }
    #bento-expiring { grid-area: expiring; }

    .arr-grid-value { font-size: 2rem; }
    .card-header h2 { font-size: 0.9375rem; } /* ~15px */
    .main-content { padding: 16px; }
    body { font-size: 13px; }
}

@media (max-width: 768px) { /* Mobile Landscape / Small Tablet */
    /* Outer container removed, layout handles full screen */
    .dashboard-layout { flex-direction: column; height: auto; overflow: auto; }
    .side-panel {
        width: 100%;
        height: auto; /* Auto height */
        border-right: none;
        border-bottom: 1px solid var(--color-border);
        overflow-y: visible; /* Allow content to expand */
        padding: 16px;
        gap: 12px; /* Reduce gap */
    }
    .main-content {
        height: auto;
        overflow-y: visible; /* Allow content to expand */
        padding: 16px;
        background-color: var(--color-background); /* Ensure BG */
    }
    body { overflow: auto; padding: 0; font-size: 13px; } /* Allow body scroll */
    .bento-grid {
        grid-template-columns: 1fr; /* Single column */
        /* Reset areas, let elements flow naturally or define single column areas */
        grid-template-areas: none;
        grid-auto-rows: auto;
        gap: 16px;
    }
    /* All bento boxes take full width */
    .bento-box { grid-column: 1 / -1 !important; grid-area: auto !important; }

    .header-content { flex-direction: column; align-items: flex-start; gap: 12px; }
    .header-controls { width: 100%; justify-content: space-between; flex-wrap: wrap; gap: 10px; }
    .title-area h1 { font-size: 1.25rem; } /* ~20px */
    .title-area p { font-size: 0.8125rem; } /* ~13px */
    .chart-container { min-height: 280px; } /* Increase min-height for mobile */
    #sankey-chart-container, #dendrogram-container { min-height: 350px; }
    #map-container { min-height: 300px; }
    #expiring-contracts-table-container .table-wrapper { max-height: 250px; } /* Limit table height */
}

@media (max-width: 480px) { /* Small Mobile */
    body { font-size: 13px; } /* Maintain readability */
    .title-area h1 { font-size: 1.125rem; } /* ~18px */
    .title-area p { font-size: 0.75rem; } /* ~12px */
    .arr-grid-value { font-size: 2rem; } /* Keep ARR prominent */
    .card-header h2 { font-size: 0.875rem; } /* ~14px */
    .side-panel, .main-content { padding: 12px; } /* Reduce padding */
    .bento-gap { --bento-gap: 12px; }
    button, .button, .primary-button { padding: 8px 12px; font-size: 0.8125rem; } /* Adjust button size */
    .input-select, .input-date, input[type="search"], input[type="text"] { padding: 8px 12px; font-size: 0.8125rem; }
    th, td { padding: 8px 10px; font-size: 0.75rem; } /* ~12px table text */
    .sidebar-info { font-size: 11px; padding: 10px; }
    .sidebar-footer { font-size: 10px; }
    .chart-container { min-height: 250px; }
    #sankey-chart-container, #dendrogram-container { min-height: 300px; }
    #map-container { min-height: 280px; }
}


/* ========================================= */
/* Final Polish & Enhancements               */
/* ========================================= */
/* Improved Focus Visible styles for better accessibility */
*:focus-visible {
    outline: 2px solid var(--color-primary); /* Use primary color */
    outline-offset: 2px;
    box-shadow: none; /* Remove potentially conflicting box-shadow */
}
/* Remove default outline when focus-visible is supported */
*:focus:not(:focus-visible) {
    outline: none;
}
/* Apply focus-visible to specific interactive elements if needed */
/* button:focus-visible, a:focus-visible, input:focus-visible, select:focus-visible { ... } */


/* ========================================= */
/* Modal Styles for Contractor Profiles      */
/* ========================================= */
.modal-backdrop {
    position: fixed;
    inset: 0; /* Modern way to set top, left, right, bottom */
    background-color: rgba(0, 0, 0, 0.6); /* Slightly darker backdrop */
    z-index: 999;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 16px; /* Add padding for smaller screens */
    opacity: 0; /* Start hidden for transition */
    visibility: hidden;
    transition: opacity 0.25s ease, visibility 0s linear 0.25s;
}
.modal-backdrop.visible { /* Class to control visibility */
    opacity: 1;
    visibility: visible;
    transition: opacity 0.25s ease;
}

.profile-modal {
    background-color: var(--color-surface);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-lg);
    width: 100%; /* Take full width within padding */
    max-width: 900px;
    max-height: calc(100vh - 64px); /* Ensure it fits viewport */
    overflow: hidden; /* Manage scroll internally */
    display: flex;
    flex-direction: column;
    border: 1px solid var(--color-border);
    position: relative; /* For close button */
    z-index: 1000;
    opacity: 0; /* Start hidden */
    transform: scale(0.95); /* Start slightly scaled down */
    transition: opacity 0.25s ease, transform 0.25s ease;
}
.modal-backdrop.visible .profile-modal {
    opacity: 1;
    transform: scale(1);
}

.modal-header { /* Added header section */
    padding: 16px 20px;
    border-bottom: 1px solid var(--color-border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-shrink: 0;
}
.modal-header h2 {
    margin: 0;
    font-size: 1.25rem; /* ~20px */
    font-weight: 600;
}

.modal-close-btn {
    background: none;
    border: none;
    cursor: pointer;
    color: var(--color-text-secondary);
    padding: 4px;
    border-radius: 50%;
    display: flex; /* Center icon */
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s ease, color 0.2s ease;
}
.modal-close-btn:hover {
    background-color: var(--color-surface-variant);
    color: var(--color-text-primary);
}
.modal-close-btn svg { width: 20px; height: 20px; }

.modal-body { /* Added body section for scroll */
    padding: 20px;
    overflow-y: auto;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.profile-stats-container {
    display: flex;
    flex-wrap: wrap;
    gap: 16px; /* Adjusted gap */
    margin-bottom: 16px;
}
.profile-stat-box {
    display: flex;
    flex-direction: column;
    gap: 4px; /* Adjusted gap */
    background-color: var(--color-surface-container);
    padding: 12px 16px; /* Adjusted padding */
    border-radius: var(--border-radius-md); /* Consistent radius */
    min-width: 130px;
    border: 1px solid var(--color-border); /* Add border */
    flex: 1; /* Allow boxes to grow */
}
.profile-stat-value {
    font-weight: 600; /* Less bold */
    font-size: 1.125rem; /* ~18px */
    color: var(--color-text-primary);
}
.profile-stat-label {
    font-size: 0.75rem; /* ~12px */
    color: var(--color-text-secondary);
    text-transform: uppercase; /* Uppercase label */
    letter-spacing: 0.05em;
}

.profile-tabs {
    display: flex;
    border-bottom: 1px solid var(--color-border);
    margin-bottom: 16px; /* Add space below tabs */
    flex-shrink: 0;
}
.profile-tab {
    padding: 12px 18px; /* Increased padding */
    background: none;
    border: none;
    border-bottom: 2px solid transparent;
    margin-bottom: -1px; /* Overlap border */
    color: var(--color-text-secondary);
    cursor: pointer;
    font-size: 0.875rem; /* ~14px */
    font-weight: 500; /* Standard weight */
    transition: border-color 0.2s ease, color 0.2s ease;
}
.profile-tab:hover {
    color: var(--color-text-primary);
}
.profile-tab.active {
    border-bottom-color: var(--color-primary);
    color: var(--color-text-primary);
    font-weight: 600; /* Bold active tab */
}

.profile-tab-content { display: none; }
.profile-tab-content.active { display: block; }

.profile-table { /* Inherits table styles, add specifics if needed */
    margin-top: 8px;
}

.clickable-row { cursor: pointer; }
.clickable-row:hover { background-color: var(--color-surface-variant); }

/* ========================================= */
/* Enhanced Filter Styles                    */
/* ========================================= */
#advanced-filters-container {
    margin-top: 16px; /* Increased spacing */
    padding-top: 16px;
    border-top: 1px solid var(--color-border);
}

.highlighted-bento { /* Style for highlighting */
    transition: all 0.3s ease-in-out;
    z-index: 10;
    outline: 2px dashed var(--color-primary);
    outline-offset: 4px;
    box-shadow: var(--shadow-lg);
}


/* ========================================= */
/* Export Button Styles                      */
/* ========================================= */
.export-container {
    display: flex;
    justify-content: flex-end;
    margin-bottom: 12px; /* Increased space */
}

.export-btn {
    /* Uses .button styles, adding specific icon alignment */
    gap: 6px;
}
.export-btn svg { width: 14px; height: 14px; }


/* ========================================= */
/* Table Sorting Styles                      */
/* ========================================= */
th.sortable-header {
    position: relative;
    cursor: pointer;
    user-select: none;
    padding-right: 24px; /* Make space for icon */
}
th.sortable-header:hover {
    background-color: var(--color-surface-variant);
    color: var(--color-primary);
}

.sort-icon {
    position: absolute; /* Position icon within header */
    right: 8px; /* Position to the right */
    top: 50%;
    transform: translateY(-50%);
    font-size: 0.9em;
    color: var(--color-text-tertiary);
    width: 1em;
    text-align: center;
    opacity: 0.6; /* Default subdued state */
    transition: color 0.2s ease, opacity 0.2s ease;
}
th.sortable-header:hover .sort-icon {
    opacity: 1; /* Show icon clearly on hover */
}
th.sortable-header.sort-asc .sort-icon,
th.sortable-header.sort-desc .sort-icon {
    color: var(--color-primary);
    opacity: 1; /* Make active icon prominent */
}

/* Active sort column header */
th.sortable-header.sort-asc,
th.sortable-header.sort-desc {
    /* background-color: var(--color-surface-container); Keep header BG consistent */
    color: var(--color-text-primary); /* Ensure text is primary */
}

/* --- End of sorting styles --- */

/* ========================================= */
/* Tooltip Base Style (for JS-driven tooltips) */
/* ========================================= */
.tooltip {
    position: absolute;
    padding: 8px 12px;
    background-color: var(--color-surface);
    color: var(--color-text-primary);
    border: 1px solid var(--color-border);
    border-radius: var(--border-radius-md); /* Consistent radius */
    font-size: 0.8125rem; /* ~13px */
    line-height: 1.4;
    z-index: 1000; /* Ensure tooltip is on top */
    pointer-events: none; /* Prevent tooltip from blocking interactions */
    box-shadow: var(--shadow-md); /* Add shadow */
    white-space: nowrap; /* Prevent wrapping */
    opacity: 0; /* Start hidden */
    visibility: hidden;
    transition: opacity 0.2s ease, visibility 0s linear 0.2s;
}
.tooltip.visible { /* Class to show tooltip */
    opacity: 1;
    visibility: visible;
    transition: opacity 0.2s ease;
}

/* Specific Tooltip Styles (e.g., for map, sankey if needed) */
.map-tooltip, #sankey-tooltip, #tree-tooltip {
    /* Inherit from .tooltip or add specific styles */
    max-width: 300px; /* Allow wrapping for longer content */
    white-space: normal;
}