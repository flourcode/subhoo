/* Import Poppins Font */
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

/* ========================================= */
/* CSS Variables - Monochromatic + Accent    */
/* ========================================= */
:root {
    /* --- CORE MONOCHROMATIC PALETTE --- */
    --mono-purple-light: #9993A1;
    --mono-purple-mid: #797484;
    --mono-purple-dark: #615C66;
    --dark-bg: #252327;
    --dark-text-main: #FFFFF3;
    --light-bg: #F4F2F6;
    --light-text-main: #36323A;

    /* --- NEW ACCENT COLOR --- */
    /* Muted Gold/Amber - provides contrast while feeling sophisticated */
    --color-accent-complementary: #D4AF37;
    --color-accent-complementary-dark: #B8992E; /* Darker shade for hover */
    --color-on-accent-complementary: var(--dark-bg); /* Text color on accent */

    /* --- Dark Mode Semantic Mapping (Default) --- */
    --color-background: var(--dark-bg);
    /* Slightly lighten surface for better figure-ground */
    --color-surface: color-mix(in srgb, var(--dark-bg) 88%, var(--mono-purple-light) 12%);
    --color-surface-variant: var(--mono-purple-dark);
    /* Adjust container shades slightly */
    --color-surface-container-lowest: color-mix(in srgb, var(--dark-bg) 94%, var(--mono-purple-light) 6%);
    --color-surface-container-low: color-mix(in srgb, var(--dark-bg) 90%, var(--mono-purple-light) 10%);
    --color-surface-container: var(--color-surface);
    --color-surface-container-high: color-mix(in srgb, var(--dark-bg) 82%, var(--mono-purple-light) 18%);
    --color-surface-container-highest: color-mix(in srgb, var(--dark-bg) 75%, var(--mono-purple-light) 25%);

    --color-on-background: var(--dark-text-main);
    --color-on-surface: var(--dark-text-main);
    --color-on-surface-variant: var(--dark-text-main);

    /* Primary (using lightest purple for standard accents) */
    --color-primary: var(--mono-purple-light);
    --color-on-primary: var(--dark-bg);
    --color-primary-container: var(--mono-purple-dark);
    --color-on-primary-container: var(--dark-text-main);

    /* Secondary (using mid purple) */
    --color-secondary: var(--mono-purple-mid);
    --color-on-secondary: var(--dark-text-main);
    --color-secondary-container: var(--mono-purple-dark);
    --color-on-secondary-container: var(--dark-text-main);

    /* Use primary accent for standard interactive elements */
    --color-accent: var(--color-primary);
    --color-accent-dark: color-mix(in srgb, var(--color-primary) 80%, var(--dark-bg) 20%);
    --color-on-accent: var(--color-on-primary);

    /* Error/Success Colors (Make more distinct) */
    /* Consider a more standard red/green if needed, but using theme colors for now */
    --color-error: #E57373; /* A muted red */
    --color-on-error: var(--dark-bg);
    --color-success: #81C784; /* A muted green */
    --color-on-success: var(--dark-bg);

    /* Outlines */
    --color-outline: var(--mono-purple-dark);
    --color-outline-variant: var(--mono-purple-mid);

    /* Elevation Shadows (Slightly enhanced for Figure-Ground) */
    --elevation-1: 0px 1px 3px 0px rgba(0, 0, 0, 0.1), 0px 1px 2px 0px rgba(0, 0, 0, 0.1);
    --elevation-2: 0px 2px 5px 0px rgba(0, 0, 0, 0.12), 0px 2px 4px 0px rgba(0, 0, 0, 0.1);
    --elevation-3: 0px 4px 8px 0px rgba(0, 0, 0, 0.12), 0px 4px 6px 0px rgba(0, 0, 0, 0.1);
    --elevation-4: 0px 6px 10px 0px rgba(0, 0, 0, 0.14), 0px 4px 8px 0px rgba(0, 0, 0, 0.12);
    --elevation-5: 0px 8px 12px 0px rgba(0, 0, 0, 0.15), 0px 6px 10px 0px rgba(0, 0, 0, 0.14);

    /* Mapped legacy variables (adjust if needed) */
    --bg-light: var(--color-background);
    --bg-card: var(--color-surface-container); /* Using slightly lighter surface */
    --color-text-primary: var(--color-on-background);
    --color-text-secondary: color-mix(in srgb, var(--dark-text-main) 70%, var(--dark-bg) 30%); /* Slightly less prominent secondary */
    --color-text-muted: var(--color-outline-variant);
    --color-border: var(--color-outline); /* Darker outline for borders */
    --color-table-header: var(--color-surface-container-high);
    --color-table-row-even: var(--color-surface-container-low);
    --color-table-row-odd: var(--color-surface-container);
    --color-charts-primary: var(--color-primary);
    --color-charts-secondary: var(--color-secondary);
    --shadow-sm: var(--elevation-1);
    --shadow-md: var(--elevation-3); /* Use stronger shadow */

    /* Bento Grid Variables */
    --bento-gap: 1.75rem; /* Increased gap for better separation */
    --bento-border-radius: 0.75rem; /* Slightly larger radius */
}

/* Light Mode Theme (Optional - Update if used) */
body.light-mode {
   /* --- Ensure light mode variables are updated similarly --- */
   /* Example: */
   --color-background: var(--light-bg);
   --color-surface: color-mix(in srgb, var(--light-bg) 92%, var(--mono-purple-dark) 8%);
   --color-surface-container: var(--color-surface);
   --bg-card: var(--color-surface-container);
   --color-text-primary: var(--light-text-main);
   --color-text-secondary: color-mix(in srgb, var(--light-text-main) 70%, var(--light-bg) 30%);
   --color-border: var(--mono-purple-mid);
   --shadow-md: var(--elevation-3);
   /* Update other light mode vars as needed */
}


/* --- Global & Utility Styles --- */
body {
    font-family: 'Poppins', sans-serif; /* Applied from previous step */
    background-color: var(--bg-light);
    color: var(--color-text-primary);
    margin: 0;
    padding: 2rem; /* Increased padding */
    line-height: 1.6; /* Improved readability */
}

h1, h2, h3, h4, h5, h6 {
    color: var(--color-text-primary);
    margin-top: 0;
    font-weight: 600; /* Semibold default for headers */
}

/* Dashboard header */
.dashboard-header {
    margin-bottom: calc(var(--bento-gap) * 1.2); /* Increased margin */
    border-bottom: 1px solid var(--color-border);
    padding-bottom: 1rem;
}

.dashboard-header h1 {
    font-size: 2.25rem; /* Larger title */
    font-weight: 700; /* Bold */
    margin-bottom: 0.35rem;
}
.dashboard-header p {
     font-size: 1.125rem;
     color: var(--color-text-secondary); /* Muted subtitle */
     margin-bottom: 0;
}

/* --- Bento Grid Layout --- */
.bento-grid {
    display: grid;
    gap: var(--bento-gap);
    grid-template-columns: repeat(3, 1fr);
    grid-template-areas:
        "controls controls controls"
        "leaders leaders leaders"
        "tavtcv tavtcv tavtcv"
        "arr arr arr"
        "notes notes notes";
}

.bento-box {
    background-color: var(--bg-card);
    box-shadow: var(--shadow-md); /* Enhanced shadow */
    border-radius: var(--bento-border-radius);
    border: 1px solid var(--color-border);
    color: var(--color-on-surface);
    padding: 1.75rem; /* Increased padding */
    display: flex;
    flex-direction: column;
    min-height: 150px;
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; /* Hover effect */
}

.bento-box:hover {
    transform: translateY(-3px); /* Subtle lift on hover */
    box-shadow: var(--elevation-4); /* Slightly stronger shadow on hover */
}

/* Assign grid areas */
#bento-controls { grid-area: controls; }
#bento-leaders  { grid-area: leaders; }
#bento-tavtcv   { grid-area: tavtcv; }
#bento-arr      { grid-area: arr; }
#bento-notes    { grid-area: notes; }


/* Specific Box Styles */
#bento-controls {
     /* Removed border/shadow from inner elements, rely on box */
     flex-direction: row;
     flex-wrap: wrap;
     align-items: center;
     gap: 1.5rem; /* Increased gap */
 }

.dataset-selector label {
     font-weight: 500; /* Medium weight */
     color: var(--color-text-secondary);
     margin-right: 0.75rem;
     font-size: 0.875rem; /* text-sm */
 }
.dataset-selector select {
     flex-grow: 1;
     /* Inherit styles from general filter select */
 }

.status-section {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-grow: 1;
    justify-content: flex-end;
}

/* Status Banner Enhancements */
#status-banner {
     padding: 0.3rem 0.8rem;
     margin: 0;
     border-radius: 0.375rem;
     transition: background-color 0.3s ease;
     background-color: transparent; /* Default transparent */
 }
#status-message {
     margin: 0;
     font-size: 0.875rem;
     font-weight: 500;
     color: var(--color-text-secondary);
     text-align: right;
 }
 #status-banner.error { background-color: color-mix(in srgb, var(--color-error) 20%, transparent); }
 #status-banner.error #status-message { color: var(--color-error); }
 #status-banner.success { background-color: color-mix(in srgb, var(--color-success) 20%, transparent); }
 #status-banner.success #status-message { color: var(--color-success); }
 #status-banner.info #status-message { color: var(--color-text-secondary); } /* Explicitly set info color */

#refresh-button {
    /* Standard button style (see .button) */
}

/* Improve box titles and subtitles for Hierarchy */
h2.bento-title {
    font-size: 1.5rem; /* Increased size */
    font-weight: 700; /* Bold */
    color: var(--color-text-primary);
    margin-bottom: 0.5rem; /* Reduced bottom margin */
    border-bottom: 1px solid var(--color-border);
    padding-bottom: 0.5rem;
}
 p.bento-subtitle {
     font-size: 0.9rem; /* Slightly larger */
     color: var(--color-text-secondary); /* Use secondary text color */
     margin-top: 0.25rem; /* Add space below title */
     margin-bottom: 1.25rem; /* Increased space before content */
 }

/* Chart container adjustments */
.chart-container {
    min-height: 300px;
    position: relative;
    flex-grow: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow-x: auto;
    width: 100%; /* Ensure it takes full width */
}
/* Ensure canvas doesn't overflow */
.chart-container canvas {
     max-width: 100%;
     max-height: 400px;
}

/* Placeholder styling */
.loading-placeholder, .error-placeholder, .no-data-placeholder {
    /* Position remains absolute */
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    color: var(--color-text-secondary);
    padding: 20px;
    width: 90%;
    font-size: 0.9rem;
}
.error-placeholder { color: var(--color-error); }

/* Table Styling Refresh */
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 0;
    color: var(--color-text-primary);
}

th, td {
    padding: 12px 16px; /* Increased padding */
    text-align: left;
    border-bottom: 1px solid var(--color-border);
    white-space: nowrap;
    font-size: 0.9rem; /* Slightly larger table text */
}

th {
    background-color: var(--color-table-header);
    font-weight: 600; /* Semibold */
    color: var(--color-text-primary);
    position: sticky; top: 0; z-index: 10;
    border-bottom: 2px solid var(--color-outline-variant); /* Stronger header bottom border */
}

tbody tr:nth-child(even) { background-color: var(--color-table-row-even); }
tbody tr:nth-child(odd) { background-color: var(--color-table-row-odd); }
tbody tr:hover {
    /* Use a subtle primary color mix for hover */
    background-color: color-mix(in srgb, var(--color-primary) 15%, var(--color-surface) 85%);
    color: var(--color-text-primary);
}
td.number { text-align: right; font-variant-numeric: tabular-nums; }

/* Spinner */
.spinner {
    /* Use primary accent color */
    border: 4px solid color-mix(in srgb, var(--color-primary) 30%, transparent);
    border-top: 4px solid var(--color-primary);
    border-radius: 50%;
    width: 30px; height: 30px;
    animation: spin 1s linear infinite;
    margin: 0 auto 10px auto;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Filter Styling Refresh */
.filter-container {
     display: flex;
     flex-wrap: wrap;
     align-items: flex-end; /* Align items to bottom for button alignment */
     gap: 1rem 1.5rem; /* Row and column gap */
     margin-bottom: 1.5rem;
     padding-bottom: 1.5rem;
     border-bottom: 1px solid var(--color-border);
 }
.filter-container > div {
    display: flex;
    flex-direction: column;
    gap: 0.35rem;
}

.filter-container label {
    font-weight: 500;
    font-size: 0.8rem; /* Slightly smaller label */
    color: var(--color-text-secondary);
}

/* Apply Similarity to Selects/Inputs */
.filter-container select,
.filter-container input[type="date"],
.dataset-selector select /* Target dataset selector too */
{
    padding: 0.6rem 0.8rem;
    border: 1px solid var(--color-outline);
    border-radius: 0.375rem;
    min-width: 160px;
    background-color: var(--color-surface-container-low); /* Use slightly different bg */
    color: var(--color-text-primary);
    font-size: 0.9rem;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
}
.filter-container select:focus,
.filter-container input[type="date"]:focus,
.dataset-selector select:focus {
    outline: none;
    border-color: var(--color-primary);
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--color-primary) 30%, transparent);
}
.filter-container input[type="date"] { min-width: 140px; }

/* General Button Styling (Similarity) */
.button {
    padding: 0.6rem 1.2rem;
    background-color: var(--color-accent); /* Standard accent */
    color: var(--color-on-accent);
    border: none;
    border-radius: 0.375rem;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 500;
    transition: background-color 0.2s ease, transform 0.1s ease;
    line-height: 1.25;
}
.button:hover {
    background-color: var(--color-accent-dark);
    transform: translateY(-1px);
}
.button:active {
    transform: translateY(0px);
}
.button:disabled {
    background-color: var(--color-outline);
    color: var(--color-text-muted);
    opacity: 0.7;
    cursor: not-allowed;
    transform: none;
}

/* Primary Action Button (ARR Calculate) - Differentiation */
#arr-calculate-button {
    background-color: var(--color-accent-complementary); /* Use new accent */
    color: var(--color-on-accent-complementary);
}
#arr-calculate-button:hover {
    background-color: var(--color-accent-complementary-dark);
}

/* ARR Result Emphasis (Hierarchy) */
#arr-result-container {
     text-align: center;
     margin-top: 1rem;
 }
#arr-result-container .result-label {
    font-size: 0.9rem;
    color: var(--color-text-secondary);
    margin-bottom: 0.5rem;
}
#arr-result {
    font-size: 2.5rem; /* Larger size */
    font-weight: 700; /* Bold */
    color: var(--color-accent-complementary); /* Use accent color for emphasis */
    margin-top: 0.5rem;
    line-height: 1.1;
}

/* ARR Loading/Error/No Data Styling */
#arr-loading, #arr-error, #arr-no-data {
    position: relative; display: none; margin-top: 1rem;
    font-size: 0.9rem;
}
#arr-error { color: var(--color-error); }
#arr-no-data { color: var(--color-text-secondary); }


/* Notes Box Styling */
#bento-notes h2 { margin-bottom: 0.75rem; border: none; padding-bottom: 0; }
#bento-notes p {
      font-size: 0.9rem;
      color: var(--color-text-secondary);
      margin-bottom: 0.75rem;
      line-height: 1.5;
}
#bento-notes p:last-child { margin-bottom: 0; }


/* --- Utility Classes (Keep consistent) --- */
.text-center { text-align: center; }
.text-sm { font-size: 0.875rem; line-height: 1.25rem; }
.text-gray-500 { color: var(--color-text-muted); }
.font-bold { font-weight: 700; }
.mt-2 { margin-top: 0.5rem; }
.text-red-600 { color: var(--color-error); }
.min-w-full { min-width: 100%; }
.divide-y > :not([hidden]) ~ :not([hidden]) {
   border-top-width: 1px;
   border-bottom-width: 0px;
   border-color: var(--color-border);
}
.font-medium { font-weight: 500; }
.text-gray-900 { color: var(--color-text-primary); }
.text-xs { font-size: 0.75rem; line-height: 1rem; }


/* --- Responsive Adjustments --- */
@media (max-width: 1024px) {
     body { padding: 1.5rem; }
     .bento-grid {
         grid-template-columns: repeat(2, 1fr);
         grid-template-areas:
             "controls controls"
             "leaders leaders"
             "tavtcv tavtcv"
             "arr arr"
             "notes notes";
         gap: 1.5rem; /* Adjust gap */
     }
     h2.bento-title { font-size: 1.35rem; }
     #arr-result { font-size: 2.25rem; }
}

@media (max-width: 768px) {
     body { padding: 1rem; }
     .bento-grid {
         grid-template-columns: 1fr;
         grid-template-areas:
             "controls"
             "leaders"
             "tavtcv"
             "arr"
             "notes";
         gap: 1.25rem; /* Adjust gap */
     }
     .bento-box { padding: 1.25rem; }
     h2.bento-title { font-size: 1.25rem; }
     #arr-result { font-size: 2rem; }
     #bento-controls {
          flex-direction: column;
          align-items: stretch;
          gap: 1rem;
      }
      .dataset-selector { min-width: unset; }
      .status-section { justify-content: space-between; }
      .filter-container { flex-direction: column; align-items: stretch; gap: 1rem; }
      .filter-container button { margin-top: 0.5rem; width: 100%; }
      .filter-container > div { width: 100%; }
      .filter-container select, .filter-container input[type="date"] { width: 100%; min-width: unset; }
}

/* TAV vs TCV chart container - ensure it's tall enough */
#bento-tavtcv .chart-container {
    min-height: 450px; /* Increased height for better visualization */
}
#tavTcvChart {
    max-height: 450px; /* Allow chart to use full container height */
}